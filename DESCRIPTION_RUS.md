## Project SPORT PORTAL

### Проект:
Спортивный портал- это платформа с мониторингом спортивных результатов и программами тренингов и обучения, где могут размещаться любое количество компаний и их отделов, а также тренеров


### Идея
У меня есть знакомая, у которой свой марафон по похудению, а также есть знакомые в другой стране, которые также тренируют группы для похудения и занятия спортом.


### Уникальность:
Существует много коммерческих платформ с товарами, но платформ спортивного направления с одновременным мониторингом и программами тренировок я не встречал


### Цель
Сделать полноценный проект, который мог бы потенциально иметь коммерческое применение. Применить полученные знания на практике. Показать знания, которые нам передал наш преподаватель на курсах.


### Исполнение:
При проектировании структуры проекта и базы данных, я учитывал реальные требования (как если бы он был коммерческим). Перед началом разработки я уточнил и проанализировал, какие данные важны для реальной работы и тренировок

### Stack:
Python, Django, Django Rest Framework, Swagger, Redoc, Faker, PIL


### Реализовано:
- Кастомные менеджеры и дополнительные юзеры (переработал и заменил громоздкие методы создания юзеров). 

- Через кастомный менеджер у меня создается 4 вида пользователей: superuser, administrator, trainer и client

- Сделал кастомную поли-аутентификацию по email или username, или nickname (по примеру github)

- Для конфиденциальности модели аутентификации и модели пользователей я разделил:
- Кастомная модель User - для аутентификации
- Кастомные модели Administrator, Coach, Client для категорий пользователей

- По примеру бухгалтерских или финансовых программ, в каждой модели есть поле creator, как создатель или редактор записи.

- Созданы кастомные классы разрешений для Суперюзеров, Администраторов, Коучей (Тренеров), Клиентов, а также дополнительные классы разрешений IsActive и IsVerified

- Все представления могут получать различные комбинации разрешений доступа из списка стандартных или кастомных.

- Жестко удалять запись имеет право только суперюзер

В админке ограничил возможность создания пользователей. Суперюзер может создавать любых пользователей. Администратор всех, кроме суперюзера. Тренер и клиент не может создавать юзеров.

В админке в зависимости от категории пользователя отключается доступность некоторых полей

В админке переопределял методы, чтобы получить отфильтрованные значения из реляционной модели для select полей

Поле creator ограничено только текущим юзером

- Всё на английском. Применил verbose_name и django утилиту translations.gettext-lazy, которая автоматически пробует сделать перевод в зависимости от гео-локации пользователя

- Четкая структура проекта в соответствии с архитектурой Django проектов

- Все текстовые и информационные константы вынес в отдельное приложение 'messages'

- Все параметры настроек размерами рисунков, допустимых значений полей вынес в отдельные модули приложений 'settings'

- Все вспомогательные функции утилиты вынес в отдельное приложение 'utils'

- Валидаторы вынесены в отдельные модули приложений 'validators'

- Все переменные по возможности без сокращений в соответствии с требованиями PEP для лучшей читабельности и понимания


### Вопросы, которые возникали и найденные решения:
- Ошибка циклического импорта при связи one-to-one. Для решения  использовал литералы вместо импорта "app.<model>"

- Поле creator из самой модели. Решение - использование литерала "self"

- Баг django с накапливанием файлов изображений решал с помощью сигналов, в которых я валидирую, изменяю или удаляю ненужные фалы изображений, чтобы было одна запись - одно изображение, если удаляется запись, то и изображение тоже

- Название файла с содержанием номера id объекта, которого еще не существует в момент сохранения файла, также решал при помощи сигналов с подменой файлов изображений и присвоением нового имени

- Использовал сигналы, чтобы валидировать размер файла и уменьшить его, для исключения переполнения сервера или умышленной отправки файла большого размера

- Стандартная админ панель не работала нормально с кастомным юзером (пароль не проверялся на повтор, пароль не хэшировался при создании и обновлении, пароль не прятался за символы при вводе), поэтому сделал кастомную админку и привязал кастомную форму, добавил промежуточное поле password2 для валидации повтора

- В связи многие many-to-many в django невозможно было сделать композитный (составной primary key (group+client), поэтому создал кастомную промежуточную таблицу

В админке поля many-to-many не работают с кастомными промежуточными таблицами. Решение - использовать admin.TabularInline (встраивать в основную админку таблицу с построчным представлением для промежуточной модели)

- Django migrations не всегда правильно проводили миграции для моделей с many-to-many и кастомной таблицей, миграции создавали таблицы и сразу же ругались, что не могут перезаписать таблицу, т.к. она уже существует. Решение -  вручную делать миграции каждой таблицы по порядку по уровню реляционных отношений.

- Django migrations не всегда корректно работали, могли сохранить какое-то поле или параметр в миграции и потом из-за этого отказывались работать. Решение - корректировать некоторые параметры файла миграции

- Bug Django когда поле Boolean возвращает из сериалайзера None, если в поле не был выставлен флаг (не выбран), в итоге поле не сохранялось, т.к. его не было в списке отвалидированных полей. Решение присваивать атрибуту при валидации вместо None значение False, тогда view видит изменения и сохраняет правильно

- Bug Django. В реляционных полях one-to-many параметр slug_field может нормально отражать поля отличные от id только, если read_only=True, иначе принимает только id или пытается строковое значение (__str__) записать в айдишник. Решение - чтобы отразить другое поле, нужно переопределять метод to_represent. 

- Bug Django.В реляционные поля many-to-many параметр slug_field может принимать только id или пытается строковое значение (__str__) записать в айдишник. Решение -  поле нельзя подменить помощью to_represent, можно назначить только другое дополнительное поле для отображения с другим именем.

- Bug Django. При сохранении числовых полей, если поле не проавлидировано, то оно просто пропускается и в базу данных ничего не записывается. Exception не вызывается, пользователь не знает, что вместо его данных было записано пустое значение. Решение - в сериализаторе определить CharField с таким же именем поля, получить строковое значение, в методе validate() конвертировать в число, провалидировать и вернуть в attrs уже правильное значение, а если невозможно, то респонс с кодом и сообщением об ошибке


### Гибкость и расширяемость:
- в данный момент это чистый back-end с информацией о персональных данных в процессе тренировок и данные о платежах клиентов с привязкой к группам (админ, urls, валидация, представления)

- в дальнейшем можно легко расширить до любых обучающих курсов и тренингов (не только спортивных)

- проект заранее заточен под разные гео-локации, все названия полей и сообщений выведены в отдельные файлы для быстрого перевода и адаптации проекта

- подключение дополнительной API, как отдельного сервиса, где тренеры, коучи могут размещать обучающие программы и давать доступ клиентам в зависимости от их статусов и оплаты

- подключение API телеграмм бота или другого активного мессенджера в конкретной стране

- подключение API мобильного приложения

- проект заранее заточен под разные гео-локации, все названия полей и сообщений выведены в отдельные файлы для быстрого перевода и адаптации проекта

- подключить фронт, как отдельный сервис, на JS или Django шаблонах и формах

- подключить парсинг с какого либо сайта с информацией о калориях, а также упражнений

- сделать перевод проекта в Fast API


### Дополнительная аналитика (front):
- в дальнейшем можно сделать вывод аналитики (графиков и диаграмм текущих показателей)

- вывод линий трендов, показывающих будущую динамику спортивных показателей

- многофакторный дисперсионный анализ, например:
- связь между количеством заплаченных денег и результатами тренировок
- связь между уровнем эмоционального состояния и результатами тренировок
- другие показателей, которые могли бы быть интересны как компаниям, так и пользователям, чтобы быть коммерчески привлекательным и давать пользователям уникальное предложение, которого нет у других платформ
